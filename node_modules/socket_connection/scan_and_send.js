var net = require('net');
var HOST = '127.0.0.1';
var PORT = 6969;

var macAdress;
var rss;
var localName;
var package;

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i= 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds) {
      break;
    }
  }
}

var noble = require('noble');
noble.on('stateChange', function(state) {
  if (state === 'poweredOn') {
    noble.startScanning([], true);
  } else {
    noble.stopScanning();
  }
});

noble.on('discover', function(peripheral) {
  macAdress = peripheral.address;
  rss = peripheral.rssi;
  localName = peripheral.advertisement.localName;
  package = peripheral.advertisement.manufacturerData;
});

var client = new net.Socket();
client.connect(PORT, HOST, macAdress, rss, localName, function() {
  console.log('CONNECTED TO: ' + HOST + ':' + PORT);
  client.write(macAdress + ' ' + rss + ' ' + localName);

});

client.on('data', function(data) {
  console.log('DATA: ' + data);
  client.destroy();

});

//client.on('close', function() {
//console.log('Connection closed');
//});
